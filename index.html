<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TRUFlow</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⏱️</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <header class="app-header">
    <h1 class="app-title">TRUFlow</h1>
    <div class="header-actions">
      <button id="btn-settings" class="header-btn" title="Settings">Settings</button>
      <button id="btn-sync" class="header-btn" title="Sync to Google Sheets">Sync</button>
      <button id="btn-restore" class="header-btn" title="Restore from Google Sheets">Restore</button>
    </div>
  </header>

  <main class="dashboard">
    <!-- LEFT PANEL: Pomodoro + Time Tracker + Project Details -->
    <section class="panel panel-left">
      <div class="pomo-section">
        <h2 class="panel-heading">Pomodoro</h2>
        <div id="pomo-display" class="pomo-display">25:00</div>
        <div class="pomo-controls">
          <button id="pomo-minus" class="pomo-adj" title="Subtract 1 minute">-1</button>
          <button id="pomo-start" class="pomo-btn">Start</button>
          <button id="pomo-reset" class="pomo-btn pomo-btn-secondary">Reset</button>
          <button id="pomo-plus" class="pomo-adj" title="Add 1 minute">+1</button>
        </div>
        <div id="pomo-status" class="pomo-status">Work Session</div>
        <div id="pomo-count" class="pomo-count" style="display:none;"></div>
      </div>

      <div class="tracker-section">
        <h2 class="panel-heading">Currently Working On</h2>
        <div class="tracker-controls">
          <select id="tracker-bucket" class="tracker-select">
            <option value="">-- Select Bucket --</option>
          </select>
          <button id="tracker-toggle" class="tracker-btn">Clock In</button>
        </div>
        <div id="tracker-elapsed" class="tracker-elapsed">0:00:00</div>
        <div id="tracker-start-time" class="tracker-start-time" style="display:none;"></div>
        <div id="tracker-weekly" class="tracker-weekly"></div>
        <div id="tracker-logs" class="tracker-logs"></div>
      </div>

      <div id="project-details" class="project-details">
        <h2 class="panel-heading">Project Details</h2>
        <div id="project-details-content" class="project-details-content">
          <p class="placeholder-text">Clock into a project to see its details here.</p>
        </div>
      </div>
    </section>

    <!-- CENTER PANEL: Kanban Board -->
    <section class="panel panel-center">
      <div class="kanban-header">
        <h2 class="panel-heading">Project Status</h2>
        <button id="btn-add-project" class="kanban-add-btn" title="Add new project">+ New Project</button>
      </div>
      <div id="kanban-board" class="kanban-board">
        <div class="kanban-column" data-column="queue">
          <h3 class="column-title">Queue</h3>
          <div class="column-cards" data-column="queue"></div>
        </div>
        <div class="kanban-column" data-column="in-progress">
          <h3 class="column-title">In Progress</h3>
          <div class="column-cards" data-column="in-progress"></div>
        </div>
        <div class="kanban-column" data-column="on-hold">
          <h3 class="column-title">On Hold</h3>
          <div class="column-cards" data-column="on-hold"></div>
        </div>
        <div class="kanban-column" data-column="done">
          <h3 class="column-title">Done</h3>
          <div class="column-cards" data-column="done"></div>
        </div>
        <div class="kanban-column" data-column="backburner">
          <h3 class="column-title">Backburner</h3>
          <div class="column-cards" data-column="backburner"></div>
        </div>
      </div>
    </section>

    <!-- RIGHT PANEL: Daily To-Do List -->
    <section class="panel panel-right">
      <h2 class="panel-heading">To-Do List <span id="todo-overdue-badge" class="todo-overdue-badge" style="display:none;"></span></h2>
      <div class="todo-add">
        <div class="todo-add-row1">
          <input type="text" id="todo-input" class="todo-input" placeholder="Add a task...">
          <button id="btn-add-todo" class="todo-add-btn">+</button>
        </div>
        <div class="todo-add-row2">
          <div id="todo-priority-pick" class="todo-priority-pick">
            <button class="todo-pri-btn" data-priority="H">H</button>
            <button class="todo-pri-btn" data-priority="M">M</button>
            <button class="todo-pri-btn" data-priority="L">L</button>
          </div>
          <input type="date" id="todo-due" class="todo-due-input">
        </div>
      </div>
      <div id="todo-list" class="todo-list">
        <p class="placeholder-text">No tasks yet. Add one above.</p>
      </div>
      <div id="todo-overdue-section" class="todo-overdue-section" style="display:none;">
        <h3 class="overdue-heading">Overdue</h3>
        <div id="todo-overdue-list" class="todo-list"></div>
      </div>
    </section>
  </main>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Settings</h2>
        <button id="settings-close" class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="settings-section">
          <div class="settings-section-title">Pomodoro</div>
          <div class="settings-row">
            <label class="settings-label">Work Duration</label>
            <input type="number" id="settings-pomo-duration" class="settings-number" min="1" max="60" value="25">
            <span class="settings-unit">min</span>
          </div>
          <div class="settings-row">
            <label class="settings-label">Break Duration</label>
            <input type="number" id="settings-break-duration" class="settings-number" min="1" max="30" value="5">
            <span class="settings-unit">min</span>
          </div>
        </div>
        <div class="settings-section">
          <div class="settings-section-title">Time Tracker Buckets</div>
          <div id="settings-buckets-list" class="settings-buckets-list"></div>
          <div class="card-add-row">
            <input type="text" id="settings-bucket-input" class="card-input card-input-sm" placeholder="New bucket name...">
            <button id="settings-bucket-add" class="card-add-btn">+</button>
          </div>
        </div>
        <div class="settings-section">
          <div class="settings-section-title">Kanban Labels</div>
          <div id="settings-labels-list" class="settings-buckets-list"></div>
          <div class="card-add-row">
            <input type="text" id="settings-label-input" class="card-input card-input-sm" placeholder="New label name...">
            <button id="settings-label-add" class="card-add-btn">+</button>
          </div>
        </div>
        <div class="settings-section">
          <div class="settings-section-title">Google Sheets Sync</div>
          <div class="settings-row">
            <label class="settings-label">Script URL</label>
            <input type="url" id="settings-sync-url" class="card-input"
                   placeholder="https://script.google.com/macros/s/…/exec"
                   style="flex:1; font-size:0.75rem;">
          </div>
          <p class="settings-sync-help">
            Deploy an Apps Script web app from your Google Sheet and paste the URL above.
            See <code>apps-script/Code.gs</code> in the project for setup instructions.
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <div></div>
        <div class="modal-footer-actions">
          <button id="settings-cancel" class="card-btn-secondary">Cancel</button>
          <button id="settings-save" class="card-btn-primary">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Card Modal (Add / Edit Project) -->
  <div id="card-modal" class="modal" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="card-modal-title">New Project</h2>
        <button id="card-modal-close" class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="card-field">
          <label class="card-label">Name</label>
          <input type="text" id="card-name" class="card-input" placeholder="Project name...">
        </div>
        <div class="card-field">
          <label class="card-label">Priority</label>
          <div class="card-priority-group">
            <label class="priority-option priority-H"><input type="radio" name="card-priority" value="H"> High</label>
            <label class="priority-option priority-M"><input type="radio" name="card-priority" value="M"> Med</label>
            <label class="priority-option priority-L"><input type="radio" name="card-priority" value="L"> Low</label>
            <label class="priority-option"><input type="radio" name="card-priority" value=""> None</label>
          </div>
        </div>
        <div class="card-field">
          <label class="card-label">Column</label>
          <select id="card-column" class="card-select">
            <option value="queue">Queue</option>
            <option value="in-progress">In Progress</option>
            <option value="on-hold">On Hold</option>
            <option value="done">Done</option>
            <option value="backburner">Backburner</option>
          </select>
        </div>
        <div class="card-field">
          <label class="card-label">Notes / Details</label>
          <textarea id="card-description" class="card-input card-textarea" placeholder="Add context, links, or notes about this project..."></textarea>
        </div>
        <!-- Time Goal -->
        <div class="card-field">
          <label class="card-label">Time Goal (hours)</label>
          <input type="number" id="card-time-goal" class="card-input"
                 placeholder="e.g. 10" min="0" step="0.5">
        </div>
        <div class="card-field">
          <label class="card-label">Labels</label>
          <div id="card-labels-list" class="card-labels-list"></div>
          <div class="card-add-row">
            <select id="card-label-input" class="card-input card-input-sm"></select>
            <button id="card-label-add-btn" class="card-add-btn">+</button>
          </div>
        </div>
        <div class="card-field">
          <label class="card-label">Checklist</label>
          <div id="card-checklist-list" class="card-checklist-list"></div>
          <div class="card-add-row">
            <input type="text" id="card-checklist-input" class="card-input card-input-sm" placeholder="Add item...">
            <button id="card-checklist-add-btn" class="card-add-btn">+</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="card-modal-delete" class="card-btn-delete" style="display:none;">Delete</button>
        <div class="modal-footer-actions">
          <button id="card-modal-cancel" class="card-btn-secondary">Cancel</button>
          <button id="card-modal-save" class="card-btn-primary">Create</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Log Entry Edit Modal -->
  <div id="log-modal" class="modal" style="display:none;">
    <div class="modal-content modal-content-sm">
      <div class="modal-header">
        <h2>Edit Time Entry</h2>
        <button id="log-modal-close" class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div id="log-modal-bucket" class="log-modal-bucket"></div>
        <div class="card-field">
          <label class="card-label">Date</label>
          <input type="date" id="log-date" class="card-input">
        </div>
        <div class="card-field">
          <label class="card-label">Start Time</label>
          <input type="time" id="log-start" class="card-input">
        </div>
        <div class="card-field">
          <label class="card-label">End Time</label>
          <input type="time" id="log-end" class="card-input">
        </div>
      </div>
      <div class="modal-footer">
        <button id="log-modal-delete" class="card-btn-delete">Delete</button>
        <div class="modal-footer-actions">
          <button id="log-modal-cancel" class="card-btn-secondary">Cancel</button>
          <button id="log-modal-save" class="card-btn-primary">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Weekly Report Modal -->
  <div id="weekly-report-modal" class="modal" style="display:none;">
    <div class="modal-content modal-content-md">
      <div class="modal-header">
        <h2>Weekly Time Report</h2>
        <button id="weekly-report-close" class="modal-close">&times;</button>
      </div>
      <div class="modal-body" id="weekly-report-body"></div>
    </div>
  </div>

  <!-- Task Edit Modal -->
  <div id="todo-edit-modal" class="modal" style="display:none;">
    <div class="modal-content modal-content-sm">
      <div class="modal-header">
        <h2>Edit Task</h2>
        <button id="todo-edit-close" class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="card-field">
          <label class="card-label">Task</label>
          <input type="text" id="todo-edit-text" class="card-input" placeholder="Task...">
        </div>
        <div class="card-field">
          <label class="card-label">Priority</label>
          <div id="todo-edit-priority" class="todo-priority-pick">
            <button class="todo-pri-btn" data-priority="H">H</button>
            <button class="todo-pri-btn" data-priority="M">M</button>
            <button class="todo-pri-btn" data-priority="L">L</button>
          </div>
        </div>
        <div class="card-field">
          <label class="card-label">Due Date</label>
          <input type="date" id="todo-edit-due" class="card-input">
        </div>
        <div class="card-field">
          <label class="card-label">Notes</label>
          <textarea id="todo-edit-notes" class="card-input card-textarea"
                    placeholder="Links, context, sub-steps..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <div></div>
        <div class="modal-footer-actions">
          <button id="todo-edit-cancel" class="card-btn-secondary">Cancel</button>
          <button id="todo-edit-save" class="card-btn-primary">Save</button>
        </div>
      </div>
    </div>
  </div>

  <script src="js/storage.js"></script>
  <script src="js/pomodoro.js"></script>
  <script src="js/timeTracker.js"></script>
  <script src="js/kanban.js"></script>
  <script src="js/todoList.js"></script>
  <script src="js/settings.js"></script>
  <script src="js/sheetsSync.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
