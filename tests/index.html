<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TRUFlow — Test Suite</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #1a1a2e;
      color: #eaeaea;
      padding: 24px;
      max-width: 800px;
      margin: 0 auto;
    }
    h1 { color: #e94560; margin-bottom: 8px; }
    .summary {
      font-size: 1.1rem;
      margin-bottom: 20px;
      padding: 12px;
      border-radius: 6px;
    }
    .summary.pass { background: rgba(39, 174, 96, 0.2); border: 1px solid #27ae60; }
    .summary.fail { background: rgba(231, 76, 60, 0.2); border: 1px solid #e74c3c; }
    .suite { margin-bottom: 20px; }
    .suite-name {
      font-size: 1rem;
      font-weight: 600;
      color: #8a8a9a;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }
    .test { padding: 6px 12px; font-size: 0.9rem; border-radius: 4px; margin-bottom: 4px; }
    .test.pass { background: rgba(39, 174, 96, 0.1); }
    .test.fail { background: rgba(231, 76, 60, 0.2); color: #e74c3c; }
    .test .label { margin-right: 8px; }
    .test .label.pass { color: #27ae60; }
    .test .label.fail { color: #e74c3c; }
  </style>
</head>
<body>
  <h1>TRUFlow Test Suite</h1>
  <div id="summary" class="summary"></div>
  <div id="results"></div>

  <!-- Test framework -->
  <script>
    const TestRunner = (() => {
      const suites = [];
      let currentSuite = null;

      function describe(name, fn) {
        currentSuite = { name, tests: [] };
        suites.push(currentSuite);
        fn();
        currentSuite = null;
      }

      function it(name, fn) {
        const test = { name, passed: false, error: null };
        try {
          fn();
          test.passed = true;
        } catch (e) {
          test.error = e.message;
        }
        currentSuite.tests.push(test);
      }

      function assert(condition, message) {
        if (!condition) {
          throw new Error(message || 'Assertion failed');
        }
      }

      function assertEqual(actual, expected, message) {
        if (actual !== expected) {
          throw new Error(message || `Expected ${JSON.stringify(expected)}, got ${JSON.stringify(actual)}`);
        }
      }

      function assertDeepEqual(actual, expected, message) {
        if (JSON.stringify(actual) !== JSON.stringify(expected)) {
          throw new Error(message || `Expected ${JSON.stringify(expected)}, got ${JSON.stringify(actual)}`);
        }
      }

      function run() {
        const resultsEl = document.getElementById('results');
        const summaryEl = document.getElementById('summary');
        let totalPass = 0;
        let totalFail = 0;

        suites.forEach(suite => {
          const suiteEl = document.createElement('div');
          suiteEl.className = 'suite';

          const nameEl = document.createElement('div');
          nameEl.className = 'suite-name';
          nameEl.textContent = suite.name;
          suiteEl.appendChild(nameEl);

          suite.tests.forEach(test => {
            const testEl = document.createElement('div');
            testEl.className = `test ${test.passed ? 'pass' : 'fail'}`;

            const label = test.passed ? 'PASS' : 'FAIL';
            testEl.innerHTML = `<span class="label ${test.passed ? 'pass' : 'fail'}">${label}</span> ${test.name}`;
            if (test.error) {
              testEl.innerHTML += `<br><small style="color:#e74c3c;margin-left:48px;">${test.error}</small>`;
            }

            suiteEl.appendChild(testEl);
            test.passed ? totalPass++ : totalFail++;
          });

          resultsEl.appendChild(suiteEl);
        });

        const total = totalPass + totalFail;
        const allPassed = totalFail === 0;
        summaryEl.className = `summary ${allPassed ? 'pass' : 'fail'}`;
        summaryEl.textContent = `${totalPass}/${total} tests passed${totalFail > 0 ? ` (${totalFail} failed)` : ''}`;
      }

      return { describe, it, assert, assertEqual, assertDeepEqual, run };
    })();

    // Shorthand
    const { describe, it, assert, assertEqual, assertDeepEqual } = TestRunner;
  </script>

  <!-- Stub DOM elements required by Pomodoro module (hidden) -->
  <div style="display:none">
    <div id="pomo-display">25:00</div>
    <button id="pomo-start">Start</button>
    <button id="pomo-reset">Reset</button>
    <button id="pomo-minus">-1</button>
    <button id="pomo-plus">+1</button>
    <div id="pomo-status">Work Session</div>
  </div>

  <!-- Stub DOM elements required by TimeTracker module (hidden) -->
  <div style="display:none">
    <select id="tracker-bucket">
      <option value="">-- Select Bucket --</option>
      <option value="Email">Email</option>
      <option value="Meetings">Meetings</option>
    </select>
    <button id="tracker-toggle">Clock In</button>
    <div id="tracker-elapsed">0:00:00</div>
    <div id="tracker-start-time"></div>
    <div id="tracker-weekly"></div>
    <div id="tracker-logs"></div>
    <!-- Log modal stubs -->
    <div id="log-modal">
      <div id="log-modal-bucket"></div>
      <input type="date" id="log-date">
      <input type="time" id="log-start">
      <input type="time" id="log-end">
      <button id="log-modal-close">×</button>
      <button id="log-modal-cancel">Cancel</button>
      <button id="log-modal-save">Save</button>
      <button id="log-modal-delete">Delete</button>
    </div>
    <!-- Weekly report modal stub -->
    <div id="weekly-report-modal">
      <div id="weekly-report-body"></div>
      <button id="weekly-report-close">×</button>
    </div>
  </div>

  <!-- Stub DOM elements required by Kanban module (hidden) -->
  <div style="display:none">
    <button id="btn-add-project">+ New Project</button>
    <div id="kanban-board">
      <div class="kanban-column" data-column="queue">
        <div class="column-cards" data-column="queue"></div>
      </div>
      <div class="kanban-column" data-column="in-progress">
        <div class="column-cards" data-column="in-progress"></div>
      </div>
      <div class="kanban-column" data-column="on-hold">
        <div class="column-cards" data-column="on-hold"></div>
      </div>
      <div class="kanban-column" data-column="done">
        <div class="column-cards" data-column="done"></div>
      </div>
      <div class="kanban-column" data-column="backburner">
        <div class="column-cards" data-column="backburner"></div>
      </div>
    </div>
    <!-- Card modal stubs -->
    <div id="card-modal">
      <h2 id="card-modal-title">New Project</h2>
      <button id="card-modal-close">×</button>
      <button id="card-modal-cancel">Cancel</button>
      <button id="card-modal-save">Create</button>
      <button id="card-modal-delete" style="display:none;">Delete</button>
      <input type="text" id="card-name">
      <textarea id="card-description"></textarea>
      <select id="card-column">
        <option value="queue">Queue</option>
        <option value="in-progress">In Progress</option>
        <option value="on-hold">On Hold</option>
        <option value="done">Done</option>
        <option value="backburner">Backburner</option>
      </select>
      <div id="card-labels-list"></div>
      <input type="text" id="card-label-input">
      <button id="card-label-add-btn">+</button>
      <div id="card-checklist-list"></div>
      <input type="text" id="card-checklist-input">
      <button id="card-checklist-add-btn">+</button>
      <input type="radio" name="card-priority" value="H">
      <input type="radio" name="card-priority" value="M">
      <input type="radio" name="card-priority" value="L">
      <input type="radio" name="card-priority" value="">
    </div>
  </div>

  <!-- Source files under test -->
  <script src="../js/storage.js"></script>
  <script src="../js/pomodoro.js"></script>
  <script src="../js/timeTracker.js"></script>
  <script src="../js/kanban.js"></script>

  <!-- Test files -->
  <script src="storage.test.js"></script>
  <script src="pomodoro.test.js"></script>
  <script src="timeTracker.test.js"></script>
  <script src="kanban.test.js"></script>

  <!-- Run all tests -->
  <script>
    // Seed defaults and initialize modules before running suites
    Storage.clearAll();
    Storage.initDefaults();
    Pomodoro.init();
    TimeTracker.init();
    Kanban.init();

    TestRunner.run();
  </script>
</body>
</html>
